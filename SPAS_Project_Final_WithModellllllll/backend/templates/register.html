<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Registration | SPAS</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    /* ---------- Background Gradient Animation ---------- */
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000000, #001a1a, #002f2f, #000);
      background-size: 300% 300%;
      animation: gradientShift 8s ease-in-out infinite;
      z-index: -3;
    }

    /* ---------- Floating Glow Particles ---------- */
    .glow {
      position: fixed;
      border-radius: 50%;
      filter: blur(12px);
      opacity: 0.6;
      animation: float 10s infinite ease-in-out;
      z-index: -2;
    }

    @keyframes float {
      0% { transform: translateY(0px); opacity: 0.7; }
      50% { transform: translateY(-40px); opacity: 1; }
      100% { transform: translateY(0px); opacity: 0.7; }
    }

    .glow.one { top: 10%; left: 20%; width: 80px; height: 80px; background: #00ffff70; }
    .glow.two { bottom: 15%; right: 25%; width: 100px; height: 100px; background: #00ffff50; animation-delay: 2s; }
    .glow.three { top: 40%; right: 10%; width: 60px; height: 60px; background: #00ffff40; animation-delay: 4s; }

    /* ---------- Background Animations ---------- */
    .background-animations {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.3;
      pointer-events: none;
    }

    .chart {
      position: absolute;
      border: 1px solid rgba(0, 255, 255, 0.3);
      background: rgba(0, 255, 255, 0.05);
      border-radius: 8px;
      overflow: hidden;
    }

    .bar {
      position: absolute;
      background: linear-gradient(to top, #00ffff, rgba(0, 255, 255, 0.3));
      bottom: 0;
      width: 20px;
      animation: barGrow 4s ease-in-out infinite alternate;
    }

    .line-graph {
      position: absolute;
      width: 200px;
      height: 100px;
      border-left: 1px solid rgba(0, 255, 255, 0.5);
      border-bottom: 1px solid rgba(0, 255, 255, 0.5);
    }

    .line-path {
      fill: none;
      stroke: #00ffff;
      stroke-width: 2;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: drawLine 8s linear infinite;
    }

    .pie-chart {
      position: absolute;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(
        #00ffff 0% 25%,
        rgba(0, 255, 255, 0.5) 25% 50%,
        rgba(0, 255, 255, 0.3) 50% 75%,
        rgba(0, 255, 255, 0.1) 75% 100%
      );
      animation: rotatePie 20s linear infinite;
    }

    .data-point {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #00ffff;
      border-radius: 50%;
      box-shadow: 0 0 10px #00ffff;
      animation: floatElement 6s ease-in-out infinite;
    }

    .number-flow {
      position: absolute;
      color: rgba(0, 255, 255, 0.7);
      font-size: 14px;
      font-family: 'Courier New', monospace;
      animation: numberFlow 15s linear infinite;
      text-shadow: 0 0 5px #00ffff;
    }

    @keyframes barGrow {
      0% { height: 20px; }
      100% { height: 80px; }
    }

    @keyframes drawLine {
      0% { stroke-dashoffset: 1000; }
      100% { stroke-dashoffset: 0; }
    }

    @keyframes rotatePie {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes floatElement {
      0%, 100% { transform: translateY(0) translateX(0); }
      50% { transform: translateY(-20px) translateX(10px); }
    }

    @keyframes numberFlow {
      0% { 
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { 
        transform: translateY(-100px) translateX(20px);
        opacity: 0;
      }
    }

    /* ---------- Registration Form Styles with Transparency ---------- */
    .registration-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      z-index: 10;
    }

    .registration-container {
      width: 100%;
      max-width: 500px;
    }

    .registration-card {
      background: rgba(22, 27, 34, 0.7); /* Transparent background */
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 25px #00ffff40;
      width: 100%;
      text-align: center;
      position: relative;
      z-index: 10;
      backdrop-filter: blur(5px); /* Glass effect */
      border: 1px solid rgba(0, 255, 255, 0.2); /* Subtle border */
    }

    .logo {
      font-size: 2rem;
      font-weight: bold;
      color: #00ffff;
      text-shadow: 0 0 15px #00ffff;
      margin-bottom: 5px;
    }

    .subtitle {
      color: #cccccc;
      margin-bottom: 20px;
      font-size: 0.85rem;
    }

    h2 {
      color: #00ffff;
      text-shadow: 0 0 15px #00ffff;
      margin-bottom: 20px;
      font-weight: 600;
      font-size: 1.4rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 5px;
    }

    @media (min-width: 640px) {
      .registration-card {
        padding: 35px 30px;
      }
      
      .form-grid {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
    }

    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      color: #00ffff;
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 0.85rem;
    }

    .form-control {
      background: rgba(13, 17, 23, 0.8); /* Slight transparency */
      border: 1px solid #00ffff60;
      color: #00ffff;
      border-radius: 8px;
      height: 42px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      width: 100%;
      padding: 0 12px;
    }

    .form-control::placeholder {
      color: #666;
      font-size: 0.8rem;
    }

    .form-control:focus {
      box-shadow: 0 0 10px #00ffff;
      border-color: #00ffff;
      background: rgba(13, 17, 23, 0.9);
      color: #00ffff;
      outline: none;
    }

    .btn-register {
      background: #00ffff;
      color: #000;
      border: none;
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 0 20px #00ffff80;
      transition: 0.3s;
      margin-top: 10px;
      font-size: 0.95rem;
      cursor: pointer;
      height: 46px;
      font-weight: bold;
    }

    .btn-register:hover {
      background: #00cccc;
      box-shadow: 0 0 30px #00ffff;
      transform: translateY(-2px);
    }

    .btn-register:active {
      transform: translateY(0);
    }

    .btn-register:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .footer-links {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #333;
      text-align: center;
    }

    a {
      color: #00ffff;
      text-decoration: none;
      transition: 0.3s;
      font-size: 0.85rem;
    }

    a:hover {
      text-shadow: 0 0 10px #00ffff;
      color: #00e6e6;
    }

    .alert {
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 15px;
      border: 1px solid;
      font-size: 0.85rem;
      text-align: left;
      background: rgba(0, 0, 0, 0.5); /* Added transparency */
      backdrop-filter: blur(5px);
    }

    .alert-success {
      background-color: rgba(0, 51, 0, 0.7);
      border-color: #00ff99;
      color: #00ff99;
    }

    .alert-danger {
      background-color: rgba(51, 0, 0, 0.7);
      border-color: #ff4444;
      color: #ff4444;
    }

    .alert-warning {
      background-color: rgba(255, 170, 0, 0.1);
      border-color: #ffaa00;
      color: #ffaa00;
    }

    .password-strength {
      font-size: 0.7rem;
      margin-top: 4px;
    }

    .strength-weak { color: #ff4444; }
    .strength-medium { color: #ffaa00; }
    .strength-strong { color: #00ff99; }

    .loading {
      display: none;
      margin: 12px auto;
      color: #00ffff;
      font-size: 0.85rem;
    }

    .spinner {
      border: 2px solid #333;
      border-top: 2px solid #00ffff;
      border-radius: 50%;
      width: 14px;
      height: 14px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 6px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .normalized-field {
      display: none;
    }

    /* Mobile-specific adjustments */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .registration-card {
        padding: 25px 20px;
      }
      
      .logo {
        font-size: 1.8rem;
      }
      
      h2 {
        font-size: 1.3rem;
        margin-bottom: 15px;
      }
      
      .form-control {
        height: 40px;
        font-size: 0.85rem;
        padding: 0 10px;
      }
      
      .btn-register {
        height: 44px;
        font-size: 0.9rem;
      }
    }

    /* Ensure page is scrollable */
    html, body {
      overflow-y: auto;
      height: auto;
    }
  </style>
</head>
<body>
  <!-- Background Glow Particles -->
  <div class="glow one"></div>
  <div class="glow two"></div>
  <div class="glow three"></div>

  <!-- Background Animations -->
  <div class="background-animations" id="backgroundAnimations"></div>

  <!-- Registration Form -->
  <div class="registration-wrapper">
    <div class="registration-container">
      <div class="registration-card">
        <div class="logo">SPAS</div>
        <div class="subtitle">Student Performance Analysis System</div>
        
        <h2>ðŸŽ“ Student Registration</h2>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form action="{{ url_for('register') }}" method="POST" id="registerForm">
          <div class="form-grid">
            <!-- Enrollment & Name -->
            <div class="form-group full-width">
              <label class="form-label">Enrollment Number</label>
              <input type="text" class="form-control" name="enrollment_no" placeholder="Enter enrollment number" required>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="name" placeholder="Enter your full name" required>
            </div>

            <!-- Email -->
            <div class="form-group full-width">
              <label class="form-label">Email Address</label>
              <input type="email" class="form-control" name="email" placeholder="Enter your email" required>
            </div>

            <!-- Department & Semester -->
            <div class="form-group">
              <label class="form-label">Department</label>
              <input type="text" class="form-control" name="department" id="department" placeholder="e.g., CSE" required>
            </div>

            <div class="form-group">
              <label class="form-label">Semester</label>
              <input type="text" class="form-control" name="semester" id="semester" placeholder="e.g., 3rd" required>
            </div>

            <!-- College -->
            <div class="form-group full-width">
              <label class="form-label">College</label>
              <input type="text" class="form-control" name="college" id="college" placeholder="Enter college name" required>
            </div>

            <!-- Password Fields -->
            <div class="form-group">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" name="password" id="password" placeholder="Min. 8 characters" required minlength="8">
              <div class="password-strength" id="passwordStrength"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Confirm Password</label>
              <input type="password" class="form-control" name="confirm_password" id="confirm_password" placeholder="Confirm password" required minlength="8">
              <div class="password-strength" id="passwordMatch"></div>
            </div>
          </div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            Creating your account...
          </div>

          <button type="submit" class="btn-register" id="submitBtn">
            Create Student Account
          </button>
        </form>

        <div class="footer-links">
          <p>Already have an account? <a href="{{ url_for('login') }}">Sign in here</a></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Create background animations
    function createBackgroundAnimations() {
      const container = document.getElementById('backgroundAnimations');
      
      // Create bar charts
      for (let i = 0; i < 8; i++) {
        const chart = document.createElement('div');
        chart.className = 'chart';
        chart.style.left = `${Math.random() * 90}%`;
        chart.style.top = `${Math.random() * 90}%`;
        chart.style.width = '60px';
        chart.style.height = '100px';
        
        for (let j = 0; j < 3; j++) {
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.left = `${j * 22}px`;
          bar.style.height = `${20 + Math.random() * 60}px`;
          bar.style.animationDelay = `${Math.random() * 2}s`;
          chart.appendChild(bar);
        }
        
        container.appendChild(chart);
      }

      // Create line graphs
      for (let i = 0; i < 6; i++) {
        const lineGraph = document.createElement('div');
        lineGraph.className = 'line-graph';
        lineGraph.style.left = `${Math.random() * 85}%`;
        lineGraph.style.top = `${Math.random() * 85}%`;
        
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '200');
        svg.setAttribute('height', '100');
        svg.setAttribute('viewBox', '0 0 200 100');
        
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', 'M0,80 L40,60 L80,30 L120,70 L160,20 L200,50');
        path.className = 'line-path';
        
        svg.appendChild(path);
        lineGraph.appendChild(svg);
        container.appendChild(lineGraph);
      }

      // Create pie charts
      for (let i = 0; i < 4; i++) {
        const pie = document.createElement('div');
        pie.className = 'pie-chart';
        pie.style.left = `${Math.random() * 85}%`;
        pie.style.top = `${Math.random() * 85}%`;
        pie.style.animationDelay = `${Math.random() * 5}s`;
        container.appendChild(pie);
      }

      // Create data points
      for (let i = 0; i < 15; i++) {
        const point = document.createElement('div');
        point.className = 'data-point';
        point.style.left = `${Math.random() * 95}%`;
        point.style.top = `${Math.random() * 95}%`;
        point.style.animationDelay = `${Math.random() * 3}s`;
        container.appendChild(point);
      }

      // Create floating numbers
      for (let i = 0; i < 20; i++) {
        const number = document.createElement('div');
        number.className = 'number-flow';
        number.textContent = Math.floor(Math.random() * 100);
        number.style.left = `${Math.random() * 90}%`;
        number.style.animationDelay = `${Math.random() * 15}s`;
        container.appendChild(number);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      createBackgroundAnimations();

      const form = document.getElementById('registerForm');
      const submitBtn = document.getElementById('submitBtn');
      const loading = document.getElementById('loading');
      const passwordInput = document.getElementById('password');
      const confirmInput = document.getElementById('confirm_password');
      const strengthIndicator = document.getElementById('passwordStrength');
      const matchIndicator = document.getElementById('passwordMatch');

      // Smart normalization mappings
      const departmentMap = {
        'cse': 'Computer Science and Engineering', 'computer science': 'Computer Science and Engineering',
        'comp sci': 'Computer Science and Engineering', 'cs': 'Computer Science and Engineering',
        'computer': 'Computer Science and Engineering', 'ece': 'Electronics and Communication Engineering',
        'electronics': 'Electronics and Communication Engineering', 'ec': 'Electronics and Communication Engineering',
        'ee': 'Electrical Engineering', 'electrical': 'Electrical Engineering',
        'me': 'Mechanical Engineering', 'mechanical': 'Mechanical Engineering',
        'civil': 'Civil Engineering', 'ce': 'Civil Engineering',
        'it': 'Information Technology', 'information tech': 'Information Technology'
      };

      const semesterMap = {
        '1': '1st Semester', '2': '2nd Semester', '3': '3rd Semester', '4': '4th Semester',
        '5': '5th Semester', '6': '6th Semester', '7': '7th Semester', '8': '8th Semester',
        'i': '1st Semester', 'ii': '2nd Semester', 'iii': '3rd Semester', 'iv': '4th Semester',
        'v': '5th Semester', 'vi': '6th Semester', 'vii': '7th Semester', 'viii': '8th Semester',
        'first': '1st Semester', 'second': '2nd Semester', 'third': '3rd Semester',
        'fourth': '4th Semester', 'fifth': '5th Semester', 'sixth': '6th Semester',
        'seventh': '7th Semester', 'eighth': '8th Semester'
      };

      const collegeMap = {
        'mit': 'Massachusetts Institute of Technology', 'iit': 'Indian Institute of Technology',
        'nit': 'National Institute of Technology', 'stanford': 'Stanford University',
        'harvard': 'Harvard University', 'uc': 'University of California',
        'caltech': 'California Institute of Technology', 'princeton': 'Princeton University'
      };

      // Smart input normalization
      function normalizeInput(value, map) {
        if (!value) return '';
        const lowerValue = value.toLowerCase().trim();
        
        if (map[lowerValue]) {
          return map[lowerValue];
        }
        
        for (const [key, normalized] of Object.entries(map)) {
          if (lowerValue.includes(key) || key.includes(lowerValue)) {
            return normalized;
          }
        }
        
        return value.split(' ')
          .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
          .join(' ');
      }

      // Setup smart inputs
      function setupSmartInput(inputId, map, fieldName) {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('blur', function() {
            const normalized = normalizeInput(this.value, map);
            if (normalized && normalized !== this.value) {
              let hiddenField = document.getElementById(`${inputId}_normalized`);
              if (!hiddenField) {
                hiddenField = document.createElement('input');
                hiddenField.type = 'hidden';
                hiddenField.name = `${fieldName}_normalized`;
                hiddenField.id = `${inputId}_normalized`;
                hiddenField.className = 'normalized-field';
                input.parentNode.appendChild(hiddenField);
              }
              hiddenField.value = normalized;
            }
          });
        }
      }

      // Initialize smart inputs
      setupSmartInput('department', departmentMap, 'department');
      setupSmartInput('semester', semesterMap, 'semester');
      setupSmartInput('college', collegeMap, 'college');

      // Password strength checker
      function checkPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (password.length >= 10) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        if (password.length === 0) {
          strengthIndicator.textContent = '';
          return 0;
        } else if (password.length < 8) {
          strengthIndicator.textContent = 'Must be at least 8 characters';
          strengthIndicator.className = 'password-strength strength-weak';
          return 0;
        } else if (strength <= 2) {
          strengthIndicator.textContent = 'Password strength: Weak';
          strengthIndicator.className = 'password-strength strength-weak';
          return 1;
        } else if (strength <= 4) {
          strengthIndicator.textContent = 'Password strength: Medium';
          strengthIndicator.className = 'password-strength strength-medium';
          return 2;
        } else {
          strengthIndicator.textContent = 'Password strength: Strong';
          strengthIndicator.className = 'password-strength strength-strong';
          return 3;
        }
      }

      // Password match checker
      function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = confirmInput.value;

        if (confirm.length === 0) {
          matchIndicator.textContent = '';
          return false;
        } else if (password === confirm) {
          matchIndicator.textContent = 'âœ“ Passwords match';
          matchIndicator.className = 'password-strength strength-strong';
          return true;
        } else {
          matchIndicator.textContent = 'âœ— Passwords do not match';
          matchIndicator.className = 'password-strength strength-weak';
          return false;
        }
      }

      // Real-time validation
      if (passwordInput) {
        passwordInput.addEventListener('input', function() {
          checkPasswordStrength(this.value);
          checkPasswordMatch();
          updateSubmitButton();
        });

        confirmInput.addEventListener('input', function() {
          checkPasswordMatch();
          updateSubmitButton();
        });
      }

      function updateSubmitButton() {
        const strength = checkPasswordStrength(passwordInput.value);
        const match = checkPasswordMatch();
        const isValid = strength >= 1 && match && passwordInput.value.length >= 8;
        submitBtn.disabled = !isValid;
      }

      // Form submission handling
      form.addEventListener('submit', function(e) {
        const match = checkPasswordMatch();
        if (!match) {
          e.preventDefault();
          showTempMessage('Passwords do not match', 'warning');
          return;
        }
        if (passwordInput.value.length < 8) {
          e.preventDefault();
          showTempMessage('Password must be at least 8 characters', 'warning');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating Account...';
        loading.style.display = 'block';
      });

      // Auto-dismiss flash messages
      setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
          alert.style.transition = 'opacity 0.5s ease';
          alert.style.opacity = '0';
          setTimeout(() => {
            if (alert.parentNode) {
              alert.parentNode.removeChild(alert);
            }
          }, 500);
        });
      }, 5000);

      // Focus first input
      const firstInput = document.querySelector('input[name="enrollment_no"]');
      if (firstInput) {
        firstInput.focus();
      }
    });

    function showTempMessage(message, type) {
      const tempAlert = document.createElement('div');
      tempAlert.className = `alert alert-${type}`;
      tempAlert.textContent = message;
      tempAlert.style.marginBottom = '20px';
      
      const firstAlert = document.querySelector('.alert');
      if (firstAlert) {
        firstAlert.parentNode.insertBefore(tempAlert, firstAlert);
      } else {
        document.querySelector('form').insertBefore(tempAlert, document.querySelector('form').firstChild);
      }
      
      setTimeout(() => {
        tempAlert.style.transition = 'opacity 0.5s ease';
        tempAlert.style.opacity = '0';
        setTimeout(() => {
          if (tempAlert.parentNode) {
            tempAlert.parentNode.removeChild(tempAlert);
          }
        }, 500);
      }, 4000);
    }
  </script>
</body>
</html>